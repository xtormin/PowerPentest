# Author: Xtormin (Jennifer Torres)
# Github: https://github.com/xtormin

param (
    [Parameter(Mandatory=$true)]
    [string]$Token,
    [Parameter(Mandatory=$true)]
    [string]$ResourcePath
)

# Request parameters
$RequestParams = @{
    Method  = 'GET'
    Uri     = 'https://management.azure.com' + $ResourcePath + '/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
    Headers = @{ 'Authorization' = "Bearer $Token" }
}

# Make the request and output the result
try {
    $response = Invoke-RestMethod @RequestParams
    $response.value
} catch {
    Write-Error "An error occurred: $_"
}


# Example usage:
# .\Get-ResourcePermissions.ps1 -Token '<TOKEN JWT>' -SubscriptionID '/subscriptions/b413826f-108d-4039-8c11-d52d5d388768/resourceGroups/TestGroup/providers/Microsoft.Compute/virtualMachines/testvm'
