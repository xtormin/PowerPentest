# Author: Xtormin (Jennifer Torres)
# Github: https://github.com/xtormin

function Get-RA-RoleAssignment{
    param (
        [Parameter(Mandatory=$true)]
        [string]$AccessToken,
        [Parameter(Mandatory=$true)]
        [string]$ResourcePath
    )

    # Request parameters
    $RequestParams = @{
        Method  = 'GET'
        Uri     = 'https://management.azure.com' + $ResourcePath + '/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
        Headers = @{ 'Authorization' = "Bearer $AccessToken" }
    }

    # Make the request and output the result
    try {
        $response = Invoke-RestMethod @RequestParams
        return $response.value
    } catch {
        Write-Error "An error occurred: $_"
    }
}

# Example usage:
# Get-RA-RoleAssignment -AccessToken '<TOKEN JWT>' -ResourcePath '/subscriptions/b413826f-108d-4049-8c11-d52d5d348768/resourceGroups/Test/providers/Microsoft.Compute/virtualMachines/infraadmin'